


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pypsyexp &mdash; PyPsyExp v2010.04 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2010.04',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/nyu_favicon.ico"/>
    <link rel="top" title="PyPsyExp v2010.04 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/images/pypsyexptitle.png" border="0" alt="pypsyexp"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
        <li><a href="../pypsyexp.html">documentation</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pypsyexp</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">pypsyexp.py</span>

<span class="sd">Created by Todd Gureckis on 2007-03-12.</span>
<span class="sd">Copyright (c) 2007 __Todd Gureckis__. All rights reserved.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#------------------------------------------------------------</span>
<span class="c"># import modules</span>
<span class="c">#------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c">#import sys</span>

<span class="kn">from</span> <span class="nn">ftplib</span> <span class="kn">import</span> <span class="n">FTP</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.numarray</span> <span class="kn">as</span> <span class="nn">na</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">pygame.locals</span> <span class="kn">as</span> <span class="nn">pglc</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">randint</span><span class="p">,</span> <span class="n">shuffle</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span> <span class="kn">as</span> <span class="nn">warn</span>
<span class="kn">from</span> <span class="nn">wave</span> <span class="kn">import</span> <span class="nb">open</span> <span class="k">as</span> <span class="n">W</span>

<span class="c"># Colors</span>
<span class="n">white</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">THECOLORS</span><span class="p">[</span><span class="s">&#39;white&#39;</span><span class="p">]</span>
<span class="n">blue</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">THECOLORS</span><span class="p">[</span><span class="s">&#39;blue&#39;</span><span class="p">]</span>
<span class="n">black</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">THECOLORS</span><span class="p">[</span><span class="s">&#39;black&#39;</span><span class="p">]</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">THECOLORS</span><span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">]</span>

<span class="c">#------------------------------------------------------------</span>
<span class="c"># MouseButton Class</span>
<span class="c"># Creates a Rect objects on initialization. Supports for </span>
<span class="c"># collidepoint method</span>
<span class="c">#------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">MouseButton</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Button class based on the</span>
<span class="sd">    template method pattern.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">containsPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>        
    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Implemented in subclasses&quot;</span>

<div class="viewcode-block" id="pgColor"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.pgColor">[docs]</a><span class="k">def</span> <span class="nf">pgColor</span><span class="p">(</span> <span class="n">colorid</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Converts either an RGB tuple or a string into a valid rgb tuple.</span>

<span class="sd">    Args:</span>
<span class="sd">     * ``colorid`` (tuple or str): Color name or rgb tuple</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        If ``colorid`` is a tuple, this simply checks for validity.</span>
<span class="sd">        If it is a string, looks it up pygame&#39;s built-in color dictionary, and</span>
<span class="sd">        returns an rgb tuple corresponding to the name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">colorid</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pygame</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">THECOLORS</span><span class="p">[</span><span class="n">colorid</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span> <span class="s">&quot;Could not find color </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">colorid</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">message</span> <span class="p">)</span>
    <span class="c"># must be an RGB code...</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="n">colorid</span><span class="p">,</span> <span class="s">&#39;__contains__&#39;</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">colorid</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span> <span class="n">colorid</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">256</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">colorid</span> <span class="p">]</span> <span class="p">):</span>
                <span class="k">return</span> <span class="n">colorid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span>  <span class="s">&quot;Invalid rgb key: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">colorid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span>  <span class="s">&quot;Invalid rgb key: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">colorid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Invalid color value : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">colorid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span>

<span class="c">#------------------------------------------------------------</span>
<span class="c"># General purpose Experiment class</span>
<span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment">[docs]</a><span class="k">class</span> <span class="nc">Experiment</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;The experiment class is a general purpose class.&quot;&quot;&quot;</span>
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># __init__</span>
    <span class="c">#------------------------------------------------------------    </span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nofullscreen</span><span class="p">,</span> <span class="n">screenres</span><span class="p">,</span> <span class="n">experimentname</span><span class="p">,</span> <span class="o">**</span><span class="n">useroptions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        Args:</span>
<span class="sd">         * nofullscreen (bool):</span>
<span class="sd">            * If ``nofullscreen`` is ``True``, the display created will be</span>
<span class="sd">              windowed.</span>
<span class="sd">            * If ``False`` (the default), the display will be fullscreen.</span>
<span class="sd">         * ``screenres`` (tuple of ints): 2-value tuple or list representing</span>
<span class="sd">           pixel dimensions.</span>
<span class="sd">         * ``experimentname`` (str): string that will be displayed as the title</span>
<span class="sd">           of the new window.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``experimentversion`` (str): The version name for the experiment.</span>
<span class="sd">         * ``fontname`` (str): Name of default font.</span>
<span class="sd">         * ``fontsize`` (int): Size of default font.</span>
<span class="sd">         * ``bgcolor`` (str or tuple): Backgound color. Default is white.</span>
<span class="sd">           String or rgb tuple.</span>
<span class="sd">         * ``fgcolor`` (str or tuple): Foreground color. Default is black.</span>
<span class="sd">           String or rgb tuple</span>
<span class="sd">         * ``patterncode`` (str): Name of patterncode file. Defaults to</span>
<span class="sd">           ``patterncode.txt`` but is only loaded if it is passed in.</span>
<span class="sd">         * ``imagedir`` (str): Directory images are in. Defaults to ``images``,</span>
<span class="sd">           but they are only loaded if it is passed in.</span>
<span class="sd">         * ``sounddir`` (str): Directory sounds are in. Defaults to ``sounds``,</span>
<span class="sd">           but they are only loaded if it is passed in.</span>
<span class="sd">         * ``datadir`` (str): Folder the datafiles will be stored in. Defaults</span>
<span class="sd">           to ``data``</span>
<span class="sd">         * ``ftphost`` (str): FTP host name</span>
<span class="sd">         * ``ftpuser`` (str): FTP user name</span>
<span class="sd">         * ``ftppassword`` (str): FTP password</span>
<span class="sd">         * ``verbose`` (bool): Print extra messages? Default is true.</span>
<span class="sd">         * ``framerate`` (int): Polling rate in fps.</span>
<span class="sd">         * ``suppresspygame`` (bool): Try not to use any pygame UI functions.</span>
<span class="sd">        </span>
<span class="sd">        sets:</span>
<span class="sd">         * ``self.options`` (dict): All keyword arguments</span>
<span class="sd">         * ``self.trial`` (dict): Signifies trial number. Initialized at 0.</span>
<span class="sd">         * ...and all possible keyword arguments are assigned their own ``self.`` names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Initializes warning behavior.</span>
        <span class="c"># Can be used to increase or decrease warning verbosity.</span>
        <span class="c"># See warnings documentation for more information.</span>
        <span class="n">warn</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&quot;default&quot;</span><span class="p">)</span>
        
        <span class="c"># Boilerplate:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c">### Reading in options/ setting defaults/ initalizing files.</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">fontname</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
            <span class="n">fgcolor</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">patterncode</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">datadir</span> <span class="o">=</span> <span class="s">&quot;data&quot;</span><span class="p">,</span>
            <span class="n">outfilename</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">imagedir</span> <span class="o">=</span> <span class="s">&quot;images&quot;</span><span class="p">,</span>
            <span class="n">sounddir</span> <span class="o">=</span> <span class="s">&quot;sounds&quot;</span><span class="p">,</span>
            <span class="n">ftphost</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">ftpuser</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">ftppassword</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">framerate</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
            <span class="n">suppresspygame</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="p">)</span>
        
        <span class="c"># Regular args:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nofullscreen</span> <span class="o">=</span> <span class="n">nofullscreen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimentname</span> <span class="o">=</span> <span class="n">experimentname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screenres</span> <span class="o">=</span> <span class="n">screenres</span>
        
        <span class="c"># Keyword arguments:</span>

        <span class="c"># Updating options dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">useroptions</span> <span class="p">)</span>
        
        <span class="c"># Assigning various</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;bgcolor&quot;</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;fgcolor&quot;</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;fontname&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;fontsize&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patterncode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;patterncode&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;datadir&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;outfilename&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;imagedir&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;sounddir&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftphost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;ftphost&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftpuser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;ftpuser&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftppassword</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;ftppassword&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;verbose&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;framerate&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suppresspygame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;suppresspygame&quot;</span><span class="p">]</span>
        
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&quot;patterncode&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cond_and_subj_number</span><span class="p">(</span> <span class="n">useroptions</span><span class="p">[</span><span class="s">&quot;patterncode&quot;</span><span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_filename</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfilename</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warning</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            WARNING: No patterncode file passed. self.cond, self.ncond, and</span>
<span class="s">            self.subj will not be set unless self.get_cond_and_subj_number is</span>
<span class="s">            called separately. Also, no datafile will be automatically written.</span>
<span class="s">            Calls to patterncode will default to assume that &#39;patterncode.txt&#39;</span>
<span class="s">            is the filename.</span>
<span class="s">            </span>
<span class="s">            To automatically read in a patterncode file, pass in a keword</span>
<span class="s">            argument for patterncode, e.g.:</span>

<span class="s">            myexp = Experiment( foo, bar, ..., patterncode=&quot;patterncode.txt&quot; )</span>
<span class="s">            &quot;&quot;&quot;</span>
            <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="n">warning</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppresspygame</span><span class="p">:</span>
            <span class="c"># UI initialization</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nofullscreen</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">screenres</span><span class="p">,</span>
                    <span class="n">pglc</span><span class="o">.</span><span class="n">HWSURFACE</span><span class="o">|</span><span class="n">pglc</span><span class="o">.</span><span class="n">DOUBLEBUF</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">screenres</span><span class="p">,</span>
                    <span class="n">pglc</span><span class="o">.</span><span class="n">HWSURFACE</span><span class="o">|</span><span class="n">pglc</span><span class="o">.</span><span class="n">DOUBLEBUF</span><span class="o">|</span><span class="n">pglc</span><span class="o">.</span><span class="n">FULLSCREEN</span><span class="p">)</span> 
            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="n">experimentname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen</span><span class="p">(</span><span class="n">rewrite_background</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
            
            <span class="c"># Loading imagedir (if it&#39;s been set)</span>
            <span class="k">if</span> <span class="s">&quot;imagedir&quot;</span> <span class="ow">in</span> <span class="n">useroptions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">imgdirset</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;&#39;imagedir&#39; was empty. Assuming experiment root directory.&quot;</span> <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="p">):</span>
                    <span class="n">msg</span><span class="o">=</span> <span class="s">&quot;Images Directory not found: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgdirset</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;&#39;imagedir&#39; not set, and no directory named &#39;</span><span class="si">%s</span><span class="s">&#39; exists. Assuming experiment root directory.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;&#39;imagedir&#39; not set. Assuming </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_all_images</span><span class="p">(</span> <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;Error loading images.&quot;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">()</span>
            
            <span class="c"># Loading sounddir (if it&#39;s been set)</span>
            <span class="k">if</span> <span class="s">&quot;sounddir&quot;</span> <span class="ow">in</span> <span class="n">useroptions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;&#39;sounddir&#39; was empty. Assuming experiment root directory.&quot;</span> <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="p">):</span>
                    <span class="n">msg</span><span class="o">=</span> <span class="s">&quot;Sounds directory not found: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;&#39;sounddir&#39; not set, and no directory named &#39;</span><span class="si">%s</span><span class="s">&#39; exists. Assuming experiment root directory.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;&#39;sounddir&#39; not set. Assuming </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_all_sounds</span><span class="p">(</span> <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;Error loading sounds.&quot;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">()</span>
    
        <span class="c"># First line output will be date/time string.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_trial</span><span class="p">(</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span> <span class="s">&quot;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span> <span class="p">)]</span> <span class="p">)</span>

    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># set_filename</span>
    <span class="c">#------------------------------------------------------------</span>
<div class="viewcode-block" id="Experiment.set_filename"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.set_filename">[docs]</a>    <span class="k">def</span> <span class="nf">set_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Sets and opens file to be written. If the name field is not</span>
<span class="sd">        passed, the datafile opened is named the current subject</span>
<span class="sd">        number. </span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``name`` (str): The filename.</span>
<span class="sd">        </span>
<span class="sd">        Sets:</span>
<span class="sd">         * ``self.filename``</span>
<span class="sd">         * ``self.datafile``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sb">`self.subj`</span> <span class="o">+</span> <span class="s">&quot;.dat&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># load_all_resources</span>
    <span class="c">#------------------------------------------------------------        </span></div>
<div class="viewcode-block" id="Experiment.load_all_resources"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.load_all_resources">[docs]</a>    <span class="k">def</span> <span class="nf">load_all_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_directory</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">snd_directory</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Loads images and sounds by calling ``load_all_images`` and</span>
<span class="sd">        ``load_all_sounds``.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``img_directory`` (str): Path to the folder containing</span>
<span class="sd">           images.</span>
<span class="sd">         * ``snd_directory`` (str): Path to the folder containing</span>
<span class="sd">           sounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">img_directory</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">snd_directory</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&quot;No filenames passed to load_all_resources.&quot;</span>
        <span class="k">if</span> <span class="n">img_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_all_images</span><span class="p">(</span><span class="n">img_directory</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">snd_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_all_sounds</span><span class="p">(</span><span class="n">snd_directory</span><span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># load_all_images</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.load_all_images"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.load_all_images">[docs]</a>    <span class="k">def</span> <span class="nf">load_all_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Loads images and places their corresponding objects into</span>
<span class="sd">       ``self.resources``. Filters out ``Thumbs.db`` files (in the case of</span>
<span class="sd">       Macs) and hidden system files. The function filters out ``Thumbs.db``</span>
<span class="sd">       files (in the case of Macs) and UNIX system files (starting with ``.``).</span>
<span class="sd">       All images are placed in a list called ``self.resources``.  All images</span>
<span class="sd">       must be referenced by name, e.g.  ``self.resources[&#39;image1.gif&#39;]``. </span>
<span class="sd">        </span>
<span class="sd">       Kwargs:</span>
<span class="sd">        * ``directory`` (str): Path to the folder containing images.</span>
<span class="sd">       </span>
<span class="sd">       Modifies:</span>
<span class="sd">           ``self.resources``</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">imagedir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="n">directory</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">directory</span> <span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span> <span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">directory</span> <span class="p">))</span>
                 <span class="k">if</span> <span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;.&quot;</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">!=</span><span class="s">&quot;thumbs.db&quot;</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fn</span> <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span> <span class="n">full_path</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span> <span class="s">&quot;IO error on image file </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">filename</span> <span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># load_all_sounds</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.load_all_sounds"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.load_all_sounds">[docs]</a>    <span class="k">def</span> <span class="nf">load_all_sounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``load_all_sounds`` takes one value, the path to the folder containing</span>
<span class="sd">        sound files.  The function filters out ``Thumbs.db`` files (in the case</span>
<span class="sd">        of Macs) and UNIX system files (starting with ``.``). All sounds are</span>
<span class="sd">        placed in a list called ``self.resources``. All sounds must be</span>
<span class="sd">        referenced by name, i.e.  ``self.resources[&#39;sound1.wav&#39;].play()``</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``directory`` (str): Path to the folder containing images.</span>
<span class="sd">        </span>
<span class="sd">        Updates:</span>
<span class="sd">            ``self.resources``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="n">directory</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">directory</span> <span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span> <span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">directory</span> <span class="p">))</span>
                 <span class="k">if</span> <span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;.&quot;</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">!=</span><span class="s">&quot;thumbs.db&quot;</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fn</span> <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span> <span class="n">full_path</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span> <span class="s">&quot;IO error on sound file </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">filename</span> <span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">sound</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># load_image</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.load_image"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.load_image">[docs]</a>    <span class="k">def</span> <span class="nf">load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">colorkey</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to load an image given its filename.</span>
<span class="sd">        </span>
<span class="sd">        It has two means of determining which color will be made transparent:</span>
<span class="sd">        </span>
<span class="sd">        1. If ``colorkey`` is not ``None``, then the color passed will be made</span>
<span class="sd">           transparent.  If ``colorkey`` is ``-1``, then the RGB value in the</span>
<span class="sd">           top left-most pixel of the image will be set as the colorkey.</span>
<span class="sd">        </span>
<span class="sd">        2. If the filename is of the format ``*-transp-x-y.EXT``, where ``EXT``</span>
<span class="sd">           is the file e``x``tension, then ``x`` and ``y`` are the ``x`` and</span>
<span class="sd">           ``y`` coordinates of the pixel that will be made transparent.</span>
<span class="sd">        </span>
<span class="sd">        If neither of these conditions are met, the image will not have</span>
<span class="sd">        transparency.</span>

<span class="sd">        Args:</span>
<span class="sd">         * ``filename`` (str): path to image file.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``colorkey`` (tuple of ints): path to image file.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The resulting image object.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ``pygame.error``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">pygame</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span>
            <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;Can&#39;t load image: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">message</span> <span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="c"># Deciding which pixel should be transparent:</span>
        <span class="k">if</span> <span class="n">colorkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colorkey</span> <span class="ow">is</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">colorkey</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">image</span><span class="o">.</span><span class="n">set_colorkey</span><span class="p">(</span><span class="n">colorkey</span><span class="p">,</span> <span class="n">RLEACCEL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">partfn</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;.&#39;</span> <span class="p">)[</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">transpkeys</span> <span class="o">=</span> <span class="n">partfn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;-&#39;</span> <span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">transpkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;transp&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">colorkey</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_at</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="n">transpkeys</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="n">image</span><span class="o">.</span><span class="n">set_colorkey</span><span class="p">(</span><span class="n">colorkey</span><span class="p">,</span> <span class="n">RLEACCEL</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;WARNING: Unable to set color key for file </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">filename</span> <span class="p">)</span>
                    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="n">message</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># get_cond_and_subj_number</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.get_cond_and_subj_number"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_cond_and_subj_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_cond_and_subj_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a patterncode file that must contain the following three values</span>
<span class="sd">        on its first three lines:</span>
<span class="sd">        </span>
<span class="sd">         1. Condition current subject will be in.</span>
<span class="sd">         2. Number of conditions.</span>
<span class="sd">         3. Current subject number (automatically updated).</span>
<span class="sd">        </span>
<span class="sd">        After reading the text file, the condition number and subject number</span>
<span class="sd">        are automatically updated and written back into the file for subsequent</span>
<span class="sd">        runnings.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``filename`` (str): Path to the patterncode file. Defaults to</span>
<span class="sd">           ``patterncode.txt``</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A list of the items in the file, in int form.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterncode</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">mymsg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            get_cond_and_subj_number could not find the patterncode </span>
<span class="s">            file (which was expected at </span><span class="si">%s</span><span class="s"> )</span>
<span class="s">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">filename</span>
            <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="n">mymsg</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">outlines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_patterncode_lines</span><span class="p">(</span> <span class="n">lines</span> <span class="p">)</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span> <span class="n">outlines</span> <span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="n">lines</span> <span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># get_cond_and_subj_number_ftp</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.get_cond_and_subj_number_ftp"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_cond_and_subj_number_ftp">[docs]</a>    <span class="k">def</span> <span class="nf">get_cond_and_subj_number_ftp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar functionallity to ``get_cond_and_subj_number``. Reads data</span>
<span class="sd">        from a remote ftp client in order to set up participant numbers and</span>
<span class="sd">        conditions. The host, username, and password can be set during the</span>
<span class="sd">        initialization of the ``Experiment`` object.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``host`` (str): web address of file hosting site</span>
<span class="sd">         * ``username`` (str): account name on the host site</span>
<span class="sd">         * ``password`` (str): password for the account </span>
<span class="sd">         * ``filename`` (str): name of patterncode file, defaults to</span>
<span class="sd">           ``patterncode.txt``</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A list containing the lines in the file, converted to ints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftphost</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftpuser</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftppassword</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterncode</span>
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="c"># connect to ftp host</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span>
            <span class="c"># TODO figure out what exception this raises.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
                <span class="n">passmessage</span> <span class="o">=</span> <span class="s">&quot;None given.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">passmessage</span> <span class="o">=</span> <span class="s">&quot;Omitted.&quot;</span>
            <span class="n">errormsg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            ERROR: Failed to connect to ftp host.</span>
<span class="s">                host: </span><span class="si">%s</span><span class="s"></span>
<span class="s">                username: </span><span class="si">%s</span><span class="s"></span>
<span class="s">                password: </span><span class="si">%s</span><span class="s"></span>
<span class="s">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">passmessage</span> <span class="p">)</span>
            <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="n">errormsg</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">retrlines</span><span class="p">(</span><span class="s">&#39;RETR &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">)</span> <span class="c"># get lines</span>
        
        <span class="n">outlines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_patterncode_lines</span><span class="p">(</span> <span class="n">lines</span> <span class="p">)</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">outlines</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># rewind to the beginning of the file</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">storlines</span><span class="p">(</span><span class="s">&#39;STOR &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">myfile</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># close deletes the tmpfile</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="n">lines</span> <span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># read_patterncode_liunes</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.read_patterncode_lines"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.read_patterncode_lines">[docs]</a>    <span class="k">def</span> <span class="nf">read_patterncode_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads lines taken from a patterncode file.</span>
<span class="sd">        File should consists of 3 lines, as follows:</span>
<span class="sd">        </span>
<span class="sd">         1. Condition current subject will be in </span>
<span class="sd">         2. Number of conditions</span>
<span class="sd">         3. Current subject number (automatically updated)</span>
<span class="sd">        </span>
<span class="sd">        Writes values to ``self.cond``, ``self.ncond``, and ``self.subj``.</span>
<span class="sd">        Returns the new lines to be written back to the file.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">         * ``lines`` (list of strs): Lines read in from patterncode file.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A list of the strings&#39; new lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outlines</span> <span class="o">=</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">int</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="p">]</span>
        
        <span class="c"># Writing new values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncond</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subj</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="c"># Incrementing the values in the outfile.</span>
        <span class="n">outlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">outlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">outlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">outlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">outlines</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">outlines</span> <span class="p">]</span>
        
        <span class="k">return</span> <span class="n">outlines</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># output_trial</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.output_trial"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.output_trial">[docs]</a>    <span class="k">def</span> <span class="nf">output_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">myline</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Writes a list of data to a file as a line in which each value seperated</span>
<span class="sd">        by a space. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">         * ``myline`` (iterable): Iterable of items to be written to the line</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``echo`` (bool): If ``True``, prints the line to the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>   
        <span class="n">myline</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">myline</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="n">echo</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">myline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">myline</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">datafile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># upload_data</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.upload_data"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.upload_data">[docs]</a>    <span class="k">def</span> <span class="nf">upload_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">netfilename</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads data to a file storage site.  FTP credentials can be set during</span>
<span class="sd">        the initialization of the ``Experiment`` object.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">         * ``host`` (str): Hostname of ftp server.</span>
<span class="sd">         * ``username`` (str): Username on server.</span>
<span class="sd">         * ``password`` (str): Password to server.</span>
<span class="sd">         * ``filename`` (str): Local file that will be uploaded. Defaults to</span>
<span class="sd">           ``self.filename``.</span>
<span class="sd">         * ``netfilename`` (str): Name of file to be written to server.</span>
<span class="sd">           Defaults to ``filename``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftphost</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftpuser</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftppassword</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">netfilename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="c"># connect to ftp host</span>
            <span class="n">ftp</span><span class="o">.</span><span class="n">storlines</span><span class="p">(</span><span class="s">&#39;STOR &#39;</span> <span class="o">+</span> <span class="n">netfilename</span><span class="p">,</span> <span class="n">myfile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
            <span class="c"># TODO: figure out what exception this raises.</span>
            <span class="n">errormsg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            ERROR: connectivity error while uploading to FTP.</span>
<span class="s">            &quot;&quot;&quot;</span>
            <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="n">errormsg</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># close</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># tick</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.tick"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits until a given time based on ``self.framerate``. Useful while in a</span>
<span class="sd">        loop, to limit the rate at which it loops.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppresspygame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># update_display</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.update_display"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.update_display">[docs]</a>    <span class="k">def</span> <span class="nf">update_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mysurf</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blits the surface passed to the default display screen created by </span>
<span class="sd">        the experiment class. Then flips it. </span>

<span class="sd">        Kwargs:</span>
<span class="sd">         * ``mysurf`` (``pygame.surface``): The surface to be written to the</span>
<span class="sd">           screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mysurf</span><span class="p">:</span>
            <span class="n">mysurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">mysurf</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># place_text_image</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.place_text_image"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.place_text_image">[docs]</a>    <span class="k">def</span> <span class="nf">place_text_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mysurf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">txtcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blits a Text object to the surface passed.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">         * ``mysurf`` (``pygame.surface``): Surface object to be blitted to.</span>
<span class="sd">         * ``prompt`` (str): String to be displayed</span>
<span class="sd">         * ``size`` (int): text size</span>
<span class="sd">         * ``xoff`` (int): Horizontal offset from center.</span>
<span class="sd">         * ``yoff`` (int): Vertical offset from center.</span>
<span class="sd">         * ``txtcolor`` (str or tuple): Color of the test (name or RGB).</span>
<span class="sd">         * ``bgcolor`` (str or tuple): Color of the background (name or RGB).</span>
<span class="sd">         * ``font`` (``pygame.font``): Font object to use for text rendering.</span>
<span class="sd">         * ``fontname`` (str): Name of font to use.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A pygame surface object with the text placed on it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Legacy arg order:</span>
        <span class="c"># mysurf, prompt, size, xoff, yoff, txtcolor, bgcolor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&quot;Prompt required.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mysurf</span><span class="p">:</span>
            <span class="n">mysurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fontname</span><span class="p">:</span>
            <span class="n">fontface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span>
        <span class="n">thisfont</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span> <span class="n">fontface</span><span class="p">,</span> <span class="n">size</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">txtcolor</span><span class="p">:</span>
            <span class="n">txtcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">txtcolor</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bgcolor</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">bgcolor</span> <span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_text_image</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">thisfont</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">txtcolor</span><span class="o">=</span><span class="n">txtcolor</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">)</span>
        <span class="n">textpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">placing_rect</span><span class="p">(</span><span class="n">mysurf</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="p">)</span>
        <span class="n">mysurf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">textpos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mysurf</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># get_text_image</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.get_text_image"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_text_image">[docs]</a>    <span class="k">def</span> <span class="nf">get_text_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txtcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Creates a Surface with anti-aliased text written on it, and returns it.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``font`` (``pygame.font``): The font to use for the text.</span>
<span class="sd">         * ``prompt`` (str): String to be displayed</span>
<span class="sd">         * ``txtcolor`` (str or tuple): Color for text (RGB or name)</span>
<span class="sd">         * ``bgcolor`` (str or tuple): Color for the background (RGB or name)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The surface with text written to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">font</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">txtcolor</span><span class="p">:</span>
            <span class="n">txtcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">txtcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txtcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">txtcolor</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bgcolor</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">bgcolor</span> <span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">txtcolor</span><span class="p">,</span> <span class="n">bgcolor</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">get_width</span><span class="p">(),</span> <span class="n">base</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="n">img</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">img</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># placing_text</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.placing_rect"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.placing_rect">[docs]</a>    <span class="k">def</span> <span class="nf">placing_rect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bkgd_surf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inner_surf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Creates a Rect from Surface ``inner_surf`` and places it onto</span>
<span class="sd">        Surface ``bkgd_surf``.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``bkgd_surf`` (``pygame.surface``): Surface to write to.</span>
<span class="sd">         * ``inner_surf`` (``pygame.surface``): Surface to write to the other</span>
<span class="sd">           surface.</span>
<span class="sd">         * ``xoff`` (int): Horizontal offset from center.</span>
<span class="sd">         * ``yoff`` (int): Vertical offset from center.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The surface created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bkgd_surf</span><span class="p">:</span>
            <span class="n">bkgd_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inner_surf</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&quot;ERROR: placing_rect requires an &#39;inner_surf&#39; argument.&quot;</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">inner_surf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">bkgd_surf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centerx</span> <span class="o">+</span> <span class="n">xoff</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">bkgd_surf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centery</span> <span class="o">+</span> <span class="n">yoff</span>
        <span class="k">return</span> <span class="n">rect</span>
        
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># play_sound</span>
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># Do we want it to return the &quot;play time&quot;? - yes</span></div>
<div class="viewcode-block" id="Experiment.play_sound"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.play_sound">[docs]</a>    <span class="k">def</span> <span class="nf">play_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sndname</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plays a sound file for its length plus and length &#39;pause&#39; in</span>
<span class="sd">        milliseconds. This function works with .wav files only. It pauses</span>
<span class="sd">        the timer.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">         * ``sndname`` (str): The sound name (omit the .wav extension)</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``pause`` (int): Time in milliseconds to pause the pygame timer</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The sound duration plus pause.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: What does &quot;it pauses the timer&quot; mean?</span>
        <span class="n">filelen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">sndname</span><span class="p">]</span><span class="o">.</span><span class="n">get_length</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">time_stamp</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">sndname</span><span class="p">]</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span> <span class="n">filelen</span> <span class="p">)</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_stamp</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="c"># TODO: What is going on here? What is this supposed to mean?</span>
            <span class="k">print</span> <span class="s">&quot;PLAY TIME  =&quot;</span><span class="p">,</span> <span class="n">rt</span> <span class="o">-</span> <span class="n">filelen</span>
        <span class="k">return</span> <span class="n">rt</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># show_centered_image</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.show_centered_image"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.show_centered_image">[docs]</a>    <span class="k">def</span> <span class="nf">show_centered_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Centers an image in the screen with a given bgcolor.</span>
<span class="sd">        </span>
<span class="sd">        Args: </span>
<span class="sd">         * ``imagename`` (str): Name of image.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``bgcolor`` (str or tuple): Background color (name or RGB)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A surface with the image blitted over a field of ``bgcolor``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bgcolor</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">bgcolor</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">imagename</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">,</span> <span class="n">xoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># show_image (for backward compatiblilty)</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.show_image"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.show_image">[docs]</a>    <span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rewrite_background</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Creates a surface object with the dimensions of the display screen.</span>
<span class="sd">        Then blits an image to the center of the surface plus any offseting</span>
<span class="sd">        height/width. The surface is then returned. </span>
<span class="sd">        </span>
<span class="sd">        .. NOTE ::</span>
<span class="sd">            This *creates* a Surface object, whereas show_image_add is passed a</span>
<span class="sd">            surface to be blitted on.</span>
<span class="sd">        </span>
<span class="sd">        Args: </span>
<span class="sd">         * ``imagename`` (str): Name of image (must be in ``self.resources``).</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``bgcolor`` (str or tuple): Background color (name or RGB)</span>
<span class="sd">         * ``xoff`` (int): Horizontal offset from center.</span>
<span class="sd">         * ``yoff`` (int): Vertical offset from center.</span>
<span class="sd">         * ``alpha`` (float): Amount of opacity. Defaults to fully opaque.</span>
<span class="sd">         * ``rewrite_background`` (bool): Whether the surface is written to</span>
<span class="sd">           ``self.background``. Defaults to ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A surface with the image blitted over a field of ``bgcolor``.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">          * KeyError: Image not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bgcolor</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">bgcolor</span> <span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
        <span class="n">outsurf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">outsurf</span> <span class="o">=</span> <span class="n">outsurf</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="n">outsurf</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">imagename</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;Could not find image: </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">imagename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span>
        <span class="n">image_rect</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">image_rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">outsurf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centerx</span> <span class="o">+</span> <span class="n">xoff</span>
        <span class="n">image_rect</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">outsurf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centery</span> <span class="o">+</span> <span class="n">yoff</span>
        
        <span class="n">outsurf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">image_rect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">outsurf</span>
        <span class="k">return</span> <span class="n">outsurf</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># show_centered_image_add</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.show_centered_image_add"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.show_centered_image_add">[docs]</a>    <span class="k">def</span> <span class="nf">show_centered_image_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mysurf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Centers an image in the surface passed. Default surface is</span>
<span class="sd">        ``self.background``.</span>
<span class="sd">        </span>
<span class="sd">        .. NOTE::</span>
<span class="sd">            This REQUIRES a Surface object to be passed, whereas show_image</span>
<span class="sd">            creates a Surface to be blitted on  </span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``mysurf`` (``pygame.surface``): Surface to blit to. Defaults to ``self.background``</span>
<span class="sd">         * ``imagename`` (str): Mandatory. Name of image (must be in</span>
<span class="sd">           ``self.resources``).</span>
<span class="sd">         * ``xoff`` (int): Horizontal offset from center.</span>
<span class="sd">         * ``yoff`` (int): Vertical offset from center.</span>
<span class="sd">         * ``alpha`` (float): Amount of opacity. Defaults to fully opaque.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A surface with the image added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">imagename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&quot;No image name passed to show_centered_image_add.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mysurf</span><span class="p">:</span>
            <span class="n">mysurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_image_add</span><span class="p">(</span><span class="n">mysurf</span><span class="p">,</span> <span class="n">imagename</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>     
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># show_image_add</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.show_image_add"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.show_image_add">[docs]</a>    <span class="k">def</span> <span class="nf">show_image_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mysurf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xoffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Places an image onto a passed Surface with given offsets relative to</span>
<span class="sd">        the center of the Surface. Returns the drawn-on Surface.</span>
<span class="sd">        </span>
<span class="sd">        mysurf - Surface to be blitted to imagename - name of the image file</span>
<span class="sd">        loaded by load_image (or load_all_images) xoffset/offset - offsets</span>
<span class="sd">        relative to the center of the Surface alpha - alpha value of the image</span>
<span class="sd">        </span>
<span class="sd">        .. NOTE::</span>
<span class="sd">            This REQUIRES a Surface object to be passed, whereas show_image</span>
<span class="sd">            creates a Surface to be blitted on  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">imagename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&quot;No image name passed to show_image_add.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mysurf</span><span class="p">:</span>
            <span class="n">mysurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">imagename</span><span class="p">]</span>
        <span class="n">image_rect</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">image_rect</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">mysurf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centerx</span> <span class="o">+</span> <span class="n">xoffset</span>
        <span class="n">image_rect</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">mysurf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centery</span> <span class="o">+</span> <span class="n">yoffset</span>
        
        <span class="n">mysurf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">image_rect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mysurf</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># clear_screen</span>
    <span class="c"># This may be more accurate if you pass the actual screen that</span>
    <span class="c"># need to be cleared and flip it after filling it with a given color</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.clear_screen"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.clear_screen">[docs]</a>    <span class="k">def</span> <span class="nf">clear_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rewrite_background</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Creates a Surface with the dimensions of the display screen, fills</span>
<span class="sd">        it with a given color, and returns the Surface.  </span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``color`` (str of tuple): Color to draw on screen (name or rgb).</span>
<span class="sd">           Defaults to ``self.bgcolor``.</span>
<span class="sd">         * ``rewrite_background`` (bool): Whether the surface is written to</span>
<span class="sd">           ``self.background``. Defaults to ``True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">color</span> <span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="n">background</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rewrite_background</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">background</span>
        <span class="k">return</span> <span class="n">background</span>    
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># get_response_and_rt_pq</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.get_response_and_rt_pq"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_response_and_rt_pq">[docs]</a>    <span class="k">def</span> <span class="nf">get_response_and_rt_pq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Monitors keyboard Events for the ``Q`` and ``P`` keys. Returns the time</span>
<span class="sd">        it took from the call to the function to the end of the function</span>
<span class="sd">        (reaction time; rt) and the response made (res). </span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``val`` (list or tuple) with coded values, e.g. ``[&#39;Left&#39;,</span>
<span class="sd">           &#39;Right&#39;]`` or ``(0, 1)``</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            A list with reaction time and the value code for the response made.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="s">&#39;q&#39;</span><span class="p">]</span> <span class="p">)</span>
    </div>
<div class="viewcode-block" id="Experiment.get_response_and_rt"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_response_and_rt">[docs]</a>    <span class="k">def</span> <span class="nf">get_response_and_rt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="s">&#39;q&#39;</span><span class="p">],</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Monitors keyboard Events for the given set of keys (default ``Q`` and</span>
<span class="sd">        &#39;P&#39;). Case insensitive. Returns the time it took from the call to the</span>
<span class="sd">        function to the end of the function (reaction time; rt) and the coded</span>
<span class="sd">        version of the response (given in &#39;val&#39;). </span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``keys`` (list or tuple of strings) where the keys are the names of</span>
<span class="sd">           the keys that will be pressed. Defaults to ``[q, p]``. Keypad</span>
<span class="sd">           numbers == keyboard numbers (although this could change) For a full</span>
<span class="sd">           list of valid key names, see the libSDL source, under</span>
<span class="sd">           ``$SDLroot/src/SDL_keyboard.c``.</span>
<span class="sd">         * ``val`` (list or tuple) with coded values, e.g. ``[&#39;Left&#39;,</span>
<span class="sd">           &#39;Right&#39;]`` or ``(0, 1)``. Defaults to be the same as ``keys``.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            ( reactiontime, resultvalue )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="n">time_stamp</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_keystroke</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">val</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span><span class="o">-</span><span class="n">time_stamp</span><span class="p">),</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="Experiment.get_response"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_response">[docs]</a>    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Legacy function name. Deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_keystroke</span><span class="p">(</span> <span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># get_keystroke ... decapitalizes capitals.</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.get_keystroke"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.get_keystroke">[docs]</a>    <span class="k">def</span> <span class="nf">get_keystroke</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for a key to be pressed, then Returns the key mapping for a</span>
<span class="sd">        single pressed letter, ignoring modifier keys. Actual key mappings are</span>
<span class="sd">        found in libSDL source, in: ``$SDLROOT/src/SDL_keyboard.c``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_for_exit</span><span class="p">()</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span> <span class="ow">and</span> <span class="n">resp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;]&quot;</span><span class="p">:</span> <span class="c"># this is how keypad keys are coded.</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">resp</span> 
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># check_for_exit</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.check_for_exit"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.check_for_exit">[docs]</a>    <span class="k">def</span> <span class="nf">check_for_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for the exit sequence: left shift plus ~.</span>
<span class="sd">        Overload this function to use a different exit keystroke.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_LSHIFT</span><span class="p">]</span> <span class="ow">and</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_BACKQUOTE</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span> <span class="n">msg</span><span class="o">=</span><span class="s">&quot;Escape sequence pressed&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="ne">KeyboardInterrupt</span><span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># prompt_text</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.prompt_text"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.prompt_text">[docs]</a>    <span class="k">def</span> <span class="nf">prompt_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">timelimit</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">prompt</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxlength</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">centered</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes an onscreen prompt for users to enter a single line of text.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs: </span>
<span class="sd">         * ``background`` (``pygame.surface``): the surface that will be</span>
<span class="sd">           refreshed; defaults to ``self.background``.</span>
<span class="sd">         * ``x`` (int): The horizontal coordinate, determining the left side of</span>
<span class="sd">           the prompt, or the center if ``centered`` is ``True``.</span>
<span class="sd">         * ``y`` (int): The vertical coordinate, determining the top of</span>
<span class="sd">           the prompt, or the center if ``centered`` is ``True``.</span>
<span class="sd">         * ``timelimit`` (int): (in milliseconds). Default is ``None``.</span>
<span class="sd">         * ``prompt`` (str): To be printed in front of the typed text. Default</span>
<span class="sd">           is a null string.</span>
<span class="sd">         * ``fontsize`` (int): Size of text printed on screen. Default is</span>
<span class="sd">           ``32``.</span>
<span class="sd">         * ``maxlength`` (int): Maximum number of characters allowed to be</span>
<span class="sd">           typed.  Default is ``40``. ``0`` means unlimited.</span>
<span class="sd">         * ``fgcolor`` (str or tuple): Color of text; name or rgb tuple.</span>
<span class="sd">           Default is ``self.fgcolor``</span>
<span class="sd">         * ``centered`` (bool): Maintain a centered alignment. ``x`` and ``y``</span>
<span class="sd">           become offset of center if ``True``. Default is ``False``.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The typed text as it appeared on the screen.</span>
<span class="sd">        </span>
<span class="sd">        Possible future options:</span>
<span class="sd">            Restrictions on possible characters.</span>
<span class="sd">            Control over typeface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">background</span><span class="p">:</span>
            <span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fgcolor</span><span class="p">:</span>
            <span class="n">fgcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">fgcolor</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">fontsize</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontname</span><span class="p">,</span> <span class="n">fontsize</span> <span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">txtbx</span> <span class="o">=</span> <span class="n">TextPrompt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">maxlength</span><span class="o">=</span><span class="n">maxlength</span><span class="p">,</span>
                           <span class="n">fgcolor</span><span class="o">=</span><span class="n">fgcolor</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">prompt</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">txtbx</span><span class="o">.</span><span class="n">get_text_line</span><span class="p">(</span><span class="n">centered</span><span class="o">=</span><span class="n">centered</span><span class="p">,</span> <span class="n">timelimit</span><span class="o">=</span><span class="n">timelimit</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">line</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_exit</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="ne">KeyboardInterrupt</span><span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># escapable_sleep</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.escapable_sleep"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.escapable_sleep">[docs]</a>    <span class="k">def</span> <span class="nf">escapable_sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">esckey</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Pauses the program for &#39;pause&#39;-number of milliseconds. Can be exited</span>
<span class="sd">        via the default keystroke in``check_for_exit``.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``pause`` (int): (in milliseconds) Amount of time to sleep for.</span>
<span class="sd">         * ``esckey`` (int; from ``pygame.locals``): A key that, if pressed,</span>
<span class="sd">           will end the pause.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">waittime</span> <span class="o">=</span> <span class="mi">0</span>    
        <span class="n">time_stamp</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">waittime</span> <span class="o">&lt;</span> <span class="n">pause</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_for_exit</span><span class="p">()</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">esckey</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">esckey</span><span class="p">]:</span>
                    <span class="k">break</span>
            <span class="n">waittime</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_stamp</span>
    </div>
<div class="viewcode-block" id="Experiment.draw_square"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.draw_square">[docs]</a>    <span class="k">def</span> <span class="nf">draw_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">thick</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Draws a square of the size and coordinates requested to the background,</span>
<span class="sd">        and returns the result.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * ``surf`` (``pygame.surface``): Surface to draw to. Defaults to</span>
<span class="sd">           ``self.background``.</span>
<span class="sd">         * ``color`` (str of tuple): Color of rectangle (name or rgb).</span>
<span class="sd">         * ``x`` (int): The coordinate of the left side of the rectangle.</span>
<span class="sd">         * ``y`` (int): The coordinate of the top of the rectangle.</span>
<span class="sd">         * ``width`` (int): The width of the rectangle. Defaults to ``10``.</span>
<span class="sd">         * ``height`` (int): The height of the rectangle. Defaults to ``10``.</span>
<span class="sd">         * ``thick`` (int): The thickness of the rectangle border. If thick is</span>
<span class="sd">           ``0`` (the default), the rectangle is filled and has no border.</span>
<span class="sd">           Otherwise it is not filled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">surf</span><span class="p">:</span>
            <span class="n">surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">color</span> <span class="p">)</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">),</span> <span class="n">thick</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surf</span>
    </div>
<div class="viewcode-block" id="Experiment.draw_on_screen_example"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.draw_on_screen_example">[docs]</a>    <span class="k">def</span> <span class="nf">draw_on_screen_example</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">break_key</span><span class="o">=</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">3</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is an example of how to allow participants to draw on the screen</span>
<span class="sd">        with a mouse. They can draw by clicking and dragging the mouse.</span>
<span class="sd">        Pressing the break_key exits the drawing environment.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * background (``pygame.surface``): The surface to draw to. Defaults to</span>
<span class="sd">           ``self.background``.</span>
<span class="sd">         * ``color`` (str or tuple): The maker color. Defaults to</span>
<span class="sd">           ``self.fgcolor``.</span>
<span class="sd">         * ``break_key`` (int (from ``pygame.locals``): Pressing this key</span>
<span class="sd">           terminates drawing.</span>
<span class="sd">         * ``radius`` (int): The radius of the drawing brush.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">background</span><span class="p">:</span>
            <span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="n">color</span> <span class="p">)</span>
        <span class="n">has_drawn</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="n">is_pressed</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">defaultcursor</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_cursor</span><span class="p">()</span>
        <span class="n">oldbackground</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_for_exit</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">is_pressed</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">has_drawn</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYUP</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="n">break_key</span> <span class="p">:</span>
                    <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">rt</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span> <span class="o">-</span> <span class="n">timestamp</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">is_pressed</span> <span class="ow">and</span> <span class="n">last_pos</span><span class="p">:</span>
                        <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span> <span class="n">background</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">radius</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span> <span class="n">background</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">radius</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_display</span><span class="p">(</span> <span class="n">background</span> <span class="p">)</span>
                    <span class="n">has_drawn</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">last_pos</span> <span class="o">=</span> <span class="n">pos</span>
                    <span class="n">is_pressed</span> <span class="o">=</span> <span class="bp">True</span>
                    
                <span class="c">#elif (event.type == MOUSEMOTION and event.buttons[0]) or (event.type == MOUSEBUTTONDOWN):</span>
                <span class="c">#    pygame.draw.circle( background, color, event.pos, radius )</span>
                <span class="c">#    self.update_display(background)</span>
                <span class="c">#    has_drawn = True</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span> <span class="o">*</span><span class="n">defaultcursor</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_display</span><span class="p">(</span> <span class="n">oldbackground</span> <span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rt</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># setup_gabor</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.setup_gabor"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.setup_gabor">[docs]</a>    <span class="k">def</span> <span class="nf">setup_gabor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_w</span><span class="p">,</span> <span class="n">grid_h</span><span class="p">,</span> <span class="n">windowsd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        This is a demo for using gabor patches. Call setup_gabor to set initial</span>
<span class="sd">        values for the gabor patch, then draw_gabor to actually draw it to a</span>
<span class="sd">        surface. They are thin wrappers to the GaborPatch class.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">         * ``grid_w`` (int): width</span>
<span class="sd">         * ``grid_h`` (int): height </span>
<span class="sd">         * ``windowsd`` (float): standard deviation  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gabor</span> <span class="o">=</span> <span class="n">GaborPatch</span><span class="p">(</span> <span class="n">grid_w</span><span class="p">,</span> <span class="n">grid_h</span><span class="p">,</span> <span class="n">windowsd</span> <span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># draw_gabor</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.draw_gabor"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.draw_gabor">[docs]</a>    <span class="k">def</span> <span class="nf">draw_gabor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        This is a demo for using gabor patches. Call setup_gabor to set initial</span>
<span class="sd">        values for the gabor patch, then draw_gabor to actually draw it to a</span>
<span class="sd">        surface. They are thin wrappers to the GaborPatch class.</span>
<span class="sd">        </span>
<span class="sd">        Draws the gabor patch set by &#39;setup_gabor&#39; </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">         * ``freq`` (int): the frequency of the gabor patch</span>
<span class="sd">         * ``angle`` (int): value to determine rotation on the patch. WARNING:</span>
<span class="sd">           units are degrees/2</span>
<span class="sd">         * ``scale`` (int) - enlarges the gabor patch by a given factor</span>
<span class="sd">        </span>
<span class="sd">        .. WARNING::</span>
<span class="sd">            Due to a bug in ``pygame``, ``angle`` is in units of degrees/2.</span>
<span class="sd">        </span>
<span class="sd">        .. NOTE::</span>
<span class="sd">            For faster blitting it is recommended to set the ``grid_w`` and</span>
<span class="sd">            ``grid_h`` in ``setup_gabor`` to be smaller than the actual patch</span>
<span class="sd">            desired. To offset this, use the scale value to blow up the image. </span>
<span class="sd">            </span>
<span class="sd">            Due to the nature of rotating a surface, the size of the surface the</span>
<span class="sd">            gabor patch changes based on the value of the rotation angle. This</span>
<span class="sd">            function re-centers the patch after each rotation, but it should be</span>
<span class="sd">            noted as it will make the area of the surface larger. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gabor</span><span class="o">.</span><span class="n">draw_gabor</span><span class="p">(</span> <span class="n">freq</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span> <span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># on_exit</span>
    <span class="c">#------------------------------------------------------------</span></div>
<div class="viewcode-block" id="Experiment.on_exit"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.Experiment.on_exit">[docs]</a>    <span class="k">def</span> <span class="nf">on_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="ne">SystemExit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Clears all data that remains on queue and closes ``self.datafile``.</span>
<span class="sd">        </span>
<span class="sd">        Kwargs:</span>
<span class="sd">         * msg (str): Exit message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">exception</span><span class="p">,</span> <span class="n">msg</span>
</div></div>
<span class="k">class</span> <span class="nc">Audio</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">abs_val</span><span class="p">,</span> <span class="n">rel_val</span><span class="p">,</span> <span class="n">sample_window</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_window</span> <span class="o">=</span> <span class="n">sample_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio_path</span> <span class="o">=</span> <span class="n">audio_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_val</span> <span class="o">=</span> <span class="n">abs_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_val</span> <span class="o">=</span> <span class="n">rel_val</span>
    
    <span class="k">def</span> <span class="nf">do_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">splits</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readwav</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audio_path</span><span class="p">)</span> <span class="c"># splits is a numpy array</span>
        <span class="n">pc_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="n">pc_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
    
        <span class="p">[</span><span class="n">absolute_l</span><span class="p">,</span> <span class="n">relative_l</span><span class="p">,</span> <span class="n">windows_l</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">histog</span><span class="p">(</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_window</span><span class="p">)</span> <span class="c"># beeps from computer</span>
        <span class="k">print</span> <span class="n">absolute_l</span><span class="p">,</span> <span class="n">relative_l</span>
    
        <span class="n">l_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsewav</span><span class="p">(</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="p">,</span> <span class="n">absolute_l</span><span class="p">,</span> <span class="n">relative_l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_window</span><span class="p">,</span> <span class="n">windows_l</span><span class="p">)</span> <span class="c"># beeps from computer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">l_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c"># every running of the experiment starts with a click noise to signal the start		</span>
        <span class="n">l_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># takes out the start click out of analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">l_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">pc_data</span><span class="p">,</span> <span class="n">l_list</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span>  <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
        
    <span class="k">def</span> <span class="nf">readwav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavfilename</span><span class="p">):</span> <span class="c"># reads the wave into 2 arrays of values</span>
        <span class="n">w</span><span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">wavfilename</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">nchannel</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">comptype</span><span class="p">,</span> <span class="n">compname</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getparams</span><span class="p">()</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="o">/</span><span class="n">rate</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">readframes</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">h&quot;</span> <span class="o">%</span><span class="n">length</span><span class="o">*</span><span class="n">nchannel</span><span class="p">,</span> <span class="n">frames</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="n">nchannel</span><span class="p">)</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="n">hsplit</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">nchannel</span><span class="p">)</span> <span class="c"># splits into left and right channels</span>
        <span class="k">return</span> <span class="n">splits</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">length</span>	
    
    <span class="k">def</span> <span class="nf">histog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="n">absolute</span> <span class="o">=</span> <span class="n">relative</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">place_holder</span> <span class="o">=</span> <span class="n">window</span> <span class="c"># need window again after some subtraction</span>
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">audio</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">audio</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># numpy</span>
        
        <span class="n">absolute</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_val</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">a</span> <span class="o">=</span> <span class="n">audio</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span> <span class="c"># start values</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">audio</span><span class="p">[</span><span class="n">window</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">],</span> <span class="n">resize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">window</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c">#end values	</span>
        <span class="c"># next line adds neg(a) and b, and appends the sum of the first window to the start of the array		</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">audio</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">window</span><span class="p">]</span> <span class="p">),</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">hstack</span><span class="p">(</span> <span class="p">(</span> <span class="n">negative</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">,</span> <span class="n">b</span> <span class="p">)</span> <span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">windows</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">(</span> <span class="n">offsets</span> <span class="p">)</span>
        
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="p">]</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">windows</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">windows</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">relative</span> <span class="o">=</span> <span class="n">where</span> <span class="p">(</span> <span class="n">cumsum</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_val</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="n">absolute</span><span class="p">,</span> <span class="n">relative</span><span class="p">,</span> <span class="n">windows</span><span class="p">]</span>	
        
    <span class="k">def</span> <span class="nf">parsewav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">absolute</span><span class="p">,</span> <span class="n">relative</span><span class="p">,</span> <span class="n">sample_window</span><span class="p">,</span> <span class="n">windows_l</span><span class="p">):</span> <span class="c"># gets sound points</span>
        
        <span class="n">d</span> <span class="o">=</span> <span class="n">greater</span><span class="p">(</span> <span class="n">audio</span><span class="p">,</span> <span class="n">absolute</span> <span class="p">)</span> <span class="c">#list of True/False based on whether indiv. samples are greater than absolute</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">greater</span><span class="p">(</span> <span class="n">windows_l</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">relative</span><span class="p">)</span> <span class="c"># same, but for windows list</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">logical_and</span><span class="p">(</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span> <span class="p">)</span>  <span class="c"># true = where both are true for both absolute and relative</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span> <span class="n">f</span> <span class="o">==</span> <span class="bp">True</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># array where both absolute and relative are true</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># new array from 1:len</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># new arrary from 0:len-1</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span> <span class="n">hstack</span><span class="p">(</span> <span class="p">(</span><span class="n">negative</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="p">),</span> <span class="n">axis</span> <span class="o">=</span><span class="mi">1</span> <span class="p">))</span> <span class="c"># difference between g+h, stacked, sumed across and abs&#39;d 	</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">asarray</span><span class="p">(</span><span class="n">where</span><span class="p">(</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">8000</span> <span class="p">)))</span> <span class="c"># indices of where the correct points are	</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">vals</span><span class="p">[:]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">44100.0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>	<span class="c"># ms... somewhere 1 value is missing, so had to add it in		</span>
        <span class="k">return</span> <span class="n">ms</span>
        
    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pc_data</span><span class="p">,</span> <span class="n">l_channel</span><span class="p">):</span>
        <span class="c"># pc_data = [  [trial, time since start, time since last click/press, RT, wait_time, response, cond] ]</span>
        <span class="c"># l_channel =  [ [time(ms), time since start(ms), time since last ], ... [], [] ]</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">pc_data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pc_data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l_channel</span><span class="p">):</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">pc_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">l_channel</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">choice</span><span class="p">)):</span>
            <span class="n">new_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span> <span class="n">pc_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pc_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">),</span> <span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">pc_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="p">),</span> <span class="n">pc_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pc_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">pc_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
    
        <span class="k">print</span> <span class="s">&quot;[trial, since_start_PC, since_start_MIC, DIFF, since_click_PC, since_click_MIC, DIFF, COND]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_array</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">i</span>
    
    <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_channel</span><span class="p">):</span>
        
        <span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l_channel</span><span class="p">)):</span> <span class="c"># i here are lists</span>
            <span class="n">time_since_last</span> <span class="o">=</span> <span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">previous</span>
            <span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span> <span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="n">time_since_last</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">l_channel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>		    

<span class="c">#------------------------------------------------------------</span>
<span class="c"># MouseButton Class</span>
<span class="c"># Creates a Rect object on initialization. Supports for </span>
<span class="c"># collidepoint method</span>
<span class="c">#------------------------------------------------------------</span>
<div class="viewcode-block" id="MouseButton"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.MouseButton">[docs]</a><span class="k">class</span> <span class="nc">MouseButton</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Button class based on the</span>
<span class="sd">    template method pattern.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<div class="viewcode-block" id="MouseButton.containsPoint"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.MouseButton.containsPoint">[docs]</a>    <span class="k">def</span> <span class="nf">containsPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>        </div>
<div class="viewcode-block" id="MouseButton.do"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.MouseButton.do">[docs]</a>    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Implemented in subclasses&quot;</span>
    
<span class="c">#------------------------------------------------------------</span>
<span class="c"># GaborPatch Class</span>
<span class="c"># Creates a GaborPatch object, which is drawn by calling draw_gabor.</span>
<span class="c">#------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="GaborPatch"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.GaborPatch">[docs]</a><span class="k">class</span> <span class="nc">GaborPatch</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ``GaborPatch`` object initializes the gabor patch when it is called. It</span>
<span class="sd">    can then be drawn by callind ``draw_gabor``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_w</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">grid_h</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">windowsd</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Sets up initial values for a gabor patch.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">         * ``grid_w`` (int): width</span>
<span class="sd">         * ``grid_h`` (int): height </span>
<span class="sd">         * ``windowsd`` (float): standard deviation  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: Gabors should also in principle have equal luminance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">grid_w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">grid_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowsd</span> <span class="o">=</span> <span class="n">windowsd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span>        
        <span class="n">normalization</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bivariate_normpdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">windowsd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">windowsd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bivariate_normpdf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">windowsd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">windowsd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="n">normalization</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)],</span><span class="n">na</span><span class="o">.</span><span class="n">Float64</span><span class="p">)</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># draw_gabor</span>
    <span class="c">#------------------------------------------------------------</span>
<div class="viewcode-block" id="GaborPatch.draw_gabor"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.GaborPatch.draw_gabor">[docs]</a>    <span class="k">def</span> <span class="nf">draw_gabor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Draws the gabor patch.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">         * ``freq`` (int): the frequency of the gabor patch.</span>
<span class="sd">         * ``angle`` (int): value to determine rotation on the patch. WARNING:</span>
<span class="sd">           units are degrees/2.</span>
<span class="sd">         * ``scale`` (int) - enlarges the gabor patch by a given factor.</span>
<span class="sd">        </span>
<span class="sd">        .. WARNING::</span>
<span class="sd">            Due to a bug in ``pygame``, ``angle`` is in units of degrees/2.</span>
<span class="sd">     </span>
<span class="sd">        .. NOTE::</span>
<span class="sd">            For faster blitting it is recommended to set the grid_w and grid_h</span>
<span class="sd">            in &#39;setup_gabor&#39; to be smaller than the actual patch desired. To</span>
<span class="sd">            offset this, use the scale value to blow up the image. </span>
<span class="sd">            </span>
<span class="sd">            Due to the nature of rotating a surface, the size of the surface the</span>
<span class="sd">            gabor patch changes based on the value of the rotation angle. This</span>
<span class="sd">            function re-centers the patch after each rotation, but it should be</span>
<span class="sd">            noted as it will make the area of the surface larger. </span>
<span class="sd">        &quot;&quot;&quot;</span>
            
            
        <span class="n">surface</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">],</span> <span class="n">SRCALPHA</span><span class="p">)</span>
        <span class="n">surface</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">white</span><span class="p">)</span>
        
        <span class="n">pixarray</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="n">surface</span><span class="p">)</span>
        <span class="n">pixrgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pixarray</span><span class="p">)</span>
        <span class="n">pixrgb</span><span class="p">[:,:,:]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">sinewavematrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="p">[((</span><span class="n">sin</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">freq</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> 
        <span class="c"># (to run faster, only compute the sine wave once)</span>
        <span class="n">finalimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">*</span> <span class="n">sinewavematrix</span>
        <span class="n">finalimg</span> <span class="o">=</span> <span class="p">[[</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
                    <span class="n">finalimg</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="n">pixarray</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">finalimg</span><span class="p">[:]</span>
        <span class="c"># rotate</span>
        <span class="n">surface</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
        <span class="n">surface</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotozoom</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="c"># adjusts for the increase in size do to rotation</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">([</span><span class="n">rect</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">h</span><span class="p">])</span>
        <span class="n">surf_rect</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
        <span class="n">surf</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">surf_rect</span><span class="p">)</span> <span class="c"># returns a larger surface</span>
        <span class="k">return</span> <span class="n">surf</span>
    
    <span class="c">#------------------------------------------------------------</span>
    <span class="c"># bivariate_normpdf</span>
    <span class="c">#------------------------------------------------------------   </span></div>
<div class="viewcode-block" id="GaborPatch.bivariate_normpdf"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.GaborPatch.bivariate_normpdf">[docs]</a>    <span class="k">def</span> <span class="nf">bivariate_normpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">,</span> <span class="n">mul</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Formula used to set the gaussion blur. Covariance is fixed at 0.</span>

<span class="sd">        .. math::</span>
<span class="sd">            \mathrm{pdf}(\mathcal{N}(\mu, \Sigma), \mathbf{x}) = (2\pi)^{-k/2} |\Sigma|^{- 1/2} e^{-(1/2)(\mathbf{x}-\mu)&#39;\Sigma^{-1}(\mathbf{x}-\mu)}</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">         * ``x`` - current position in the grid</span>
<span class="sd">         * ``y`` - current position in the grid</span>
<span class="sd">         * ``sigma_y`` - variance in each plane of the grid</span>
<span class="sd">         * ``sigma_x`` - variance in each plane of the grid</span>
<span class="sd">         * ``mu_x`` - mean on the ``x`` dimension.</span>
<span class="sd">         * ``mu_y`` - mean on the ``y`` dimension.</span>
<span class="sd">         * ``mul`` - scales by this amplitude factor </span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         The pdf for the given distribution at the given coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">return</span> <span class="n">mul</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">*</span><span class="n">sigma_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">mu_x</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="n">sigma_x</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">mu_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigma_y</span><span class="o">**</span><span class="mf">2.0</span><span class="p">))</span> 
</div></div>
<div class="viewcode-block" id="TextPrompt"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt">[docs]</a><span class="k">class</span> <span class="nc">TextPrompt</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A text input prompt. Allows the on-screen editing of a single line of text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">screen</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="o">**</span><span class="n">useroptions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TextPrompt accepts the following keyword arguments when it starts up:</span>
<span class="sd">            x, y, font, fgcolor, restricted, maxlength, prompt. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
            <span class="n">y</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
            <span class="n">font</span><span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="n">fgcolor</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> 
            <span class="n">restricted</span><span class="o">=</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!&quot;#$%&amp;</span><span class="se">\\\&#39;</span><span class="s">()*+,-./:;&lt;=&gt;?@[\]^_`{|}~</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span>
            <span class="n">maxlength</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">prompt</span><span class="o">=</span> <span class="s">&#39;&#39;</span> 
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">useroptions</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;font&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="o">=</span> <span class="n">pgColor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restricted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;restricted&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;maxlength&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;prompt&#39;</span><span class="p">];</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shifted</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="c"># This could be made an option but it&#39;s probably not necessary:</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">set_repeat</span><span class="p">(</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">150</span> <span class="p">)</span>
        
    
<div class="viewcode-block" id="TextPrompt.center"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt.center">[docs]</a>    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">centerx</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span><span class="p">)</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="TextPrompt.set_pos"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt.set_pos">[docs]</a>    <span class="k">def</span> <span class="nf">set_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the position to x, y &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
    </div>
<div class="viewcode-block" id="TextPrompt.set_font"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt.set_font">[docs]</a>    <span class="k">def</span> <span class="nf">set_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the font for the input &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span>
    </div>
<div class="viewcode-block" id="TextPrompt.draw"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Draw the text input to the screen &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="TextPrompt.update"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the input based on a list of events passed in.</span>
<span class="sd">        Returns true if enter is pressed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># key.name doesn&#39;t know about shifting. Manual fix:</span>
        <span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span> <span class="s">&quot;`1234567890-=[]\;&#39;,./&quot;</span><span class="p">,</span> <span class="s">&#39;~!@#$%^&amp;*()_+{}|:&quot;&lt;&gt;?&#39;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_LSHIFT</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_RSHIFT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shifted</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_RETURN</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_BACKSPACE</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span>
                    <span class="k">continue</span>
                <span class="c">#modsraw = event.key.get_mods()</span>
                <span class="n">keydown</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">(</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shifted</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">keydown</span> <span class="ow">in</span> <span class="n">conversion</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">keydown</span> <span class="o">=</span> <span class="n">conversion</span><span class="p">[</span> <span class="n">keydown</span> <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">keydown</span> <span class="o">=</span> <span class="n">keydown</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">keydown</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restricted</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="n">keydown</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">KEYUP</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_LSHIFT</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pglc</span><span class="o">.</span><span class="n">K_RSHIFT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shifted</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlength</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">maxlength</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">False</span>
    </div>
<div class="viewcode-block" id="TextPrompt.get_text_line"><a class="viewcode-back" href="../pypsyexp.html#pypsyexp.TextPrompt.get_text_line">[docs]</a>    <span class="k">def</span> <span class="nf">get_text_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">timelimit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prompts the user for a line of text, updating it as they type.</span>
<span class="sd">        </span>
<span class="sd">        The escape sequence here is to press both shift keys and tilde (this is</span>
<span class="sd">        to prevent subjects from accidentally quitting the experiment using</span>
<span class="sd">        tilde).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># create the pygame clock</span>
        <span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># have the program is running at 40 fps</span>
            <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
            
            <span class="c"># events for self</span>
            <span class="n">events</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="c"># process other events</span>
            <span class="k">if</span> <span class="n">timelimit</span> <span class="ow">and</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span><span class="o">-</span><span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">timelimit</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">and</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_RETURN</span><span class="p">]:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_LSHIFT</span><span class="p">]</span> <span class="ow">and</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_RSHIFT</span><span class="p">]</span> <span class="ow">and</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">pglc</span><span class="o">.</span><span class="n">K_BACKQUOTE</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="s">&quot;Quit sequence pressed.&quot;</span>
            
            <span class="c"># clear the screen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
            
            <span class="c"># update self</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
            
            <span class="c"># blit self on the sceen</span>
            <span class="k">if</span> <span class="n">centered</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="c"># refresh the display</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
</div></div>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">warn</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span> <span class="s">&quot;This is the Python Psychology Experimnt library (pypsyexp) developed by the Computational Cognition lab at NYU.&quot;</span> <span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
        <li><a href="../pypsyexp.html">documentation</a>|&nbsp;</li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Todd Gureckis.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>